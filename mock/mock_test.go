package mock

import (
	"crypto/sha256"
	"encoding/hex"
	"testing"
)

func TestVerifyMockSeal(t *testing.T) {
	imageIDBytes, err := hex.DecodeString("44bc1f4eb9588657fc753805dfd3a04a353d96d3ced37b4ad44932544d7efe36")
	if err != nil {
		t.Fatal(err)
	}
	var imageID [32]byte
	copy(imageID[:], imageIDBytes)

	sealWithSel, err := hex.DecodeString("0000000057d55d8cd7614f5d209637b06aff7913dd6405b15089f1385dd037931d1eef1d")
	if err != nil {
		t.Fatal(err)
	}
	var selector [4]byte
	copy(selector[:], sealWithSel[:4])
	var seal [32]byte
	copy(seal[:], sealWithSel[4:])

	commit, err := hex.DecodeString("00000003000000000500606a000000d61f4e3d30011899d16131d4c940ef1f75ec53d7f9a70cbb3aab1f5ab0235b2b000000000000000100000000ffffffff4820f3376ae6b2f2034d3b7a4b48a7780000000000000000000000000000000000000000000000000000000000000000070000000000000007000000000000003a354bf808b89267b19c6b390ee484d1bee8d301d0058fac511a900d5d0a6f68000000000000000000000000000000000000000000000000000000000000000083d719e77deaca1470f6baf62a4d774303c899db69020f9c70ee1dfc08c7ce9e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001d47041c46f0de729bd0ae6b0010d564120aacc69000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000e494e54454c2d53412d3030333334000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e494e54454c2d53412d3030363135000000000000000000000000000000000000")
	if err != nil {
		t.Fatal(err)
	}
	journalDigest := sha256.Sum256(commit)
	err = VerifyMockSealBySelector(
		selector,
		seal[:],
		imageID,
		journalDigest,
	)
	if err != nil {
		t.Fatal(err)
	}
}
